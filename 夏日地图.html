<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NERV Summer Vacation Map</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    <!-- Fonts -->
    <link
        href="https://fonts.googleapis.com/css2?family=Kiwi+Maru:wght@400;500&family=M+PLUS+Rounded+1c:wght@400;700;800&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            /* ç³–æœè‰² EVA é…è‰² */
            --eva-01-purple: #a78bfa;
            /* åˆå·æœºç´« */
            --eva-01-green: #4ade80;
            /* åˆå·æœºç»¿ */
            --eva-02-red: #fb7185;
            /* äºŒå·æœºçº¢ */
            --eva-02-orange: #fbbf24;
            /* äºŒå·æœºæ©™ */
            --eva-00-blue: #60a5fa;
            /* é›¶å·æœº/ç»«æ³¢è“ */
            --eva-00-white: #f3f4f6;

            --summer-bg: #f0f9ff;
        }

        body {
            background-color: var(--summer-bg);
            color: #374151;
            font-family: 'M PLUS Rounded 1c', sans-serif;
            overflow: hidden;
        }

        .font-cute {
            font-family: 'Kiwi Maru', serif;
        }

        /* --- åœ°å›¾å®¹å™¨ --- */
        #map {
            width: 100%;
            height: 100%;
            background: #e0f2fe;
            z-index: 1;
        }

        /* æ˜äº®æ—¥ç³»æ»¤é•œ */
        .leaflet-layer {
            filter: contrast(1.05) saturate(1.1) brightness(1.05);
        }

        .leaflet-control-attribution {
            display: none;
        }

        /* --- Marker æ ·å¼ --- */
        .eva-marker-icon {
            background: transparent;
            border: none;
        }

        .marker-svg {
            overflow: visible;
        }

        .marker-group {
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            cursor: pointer;
        }

        /* æ–°ç‰ˆå…­è¾¹å½¢å¾½ç« æ ·å¼ */
        .marker-badge {
            filter: drop-shadow(0 4px 6px rgba(0, 0, 0, 0.15));
        }

        .marker-bg {
            fill: white;
        }

        /* ä¸åŒçš„ EVA æœºä½“é…è‰²ç±» */
        .unit-01 .marker-stroke {
            stroke: var(--eva-01-purple);
            stroke-width: 3;
            fill: white;
        }

        .unit-01 .marker-fill {
            fill: var(--eva-01-purple);
        }

        .unit-01 .marker-accent {
            fill: var(--eva-01-green);
        }

        .unit-01 .marker-label {
            fill: var(--eva-01-purple);
        }

        .unit-02 .marker-stroke {
            stroke: var(--eva-02-red);
            stroke-width: 3;
            fill: white;
        }

        .unit-02 .marker-fill {
            fill: var(--eva-02-red);
        }

        .unit-02 .marker-accent {
            fill: var(--eva-02-orange);
        }

        .unit-02 .marker-label {
            fill: var(--eva-02-red);
        }

        .unit-00 .marker-stroke {
            stroke: var(--eva-00-blue);
            stroke-width: 3;
            fill: white;
        }

        .unit-00 .marker-fill {
            fill: var(--eva-00-blue);
        }

        .unit-00 .marker-accent {
            fill: #9ca3af;
        }

        .unit-00 .marker-label {
            fill: var(--eva-00-blue);
        }

        .marker-label {
            font-size: 14px;
            font-weight: 800;
            stroke: white;
            stroke-width: 3px;
            paint-order: stroke;
        }

        .marker-number {
            font-family: monospace;
            font-weight: bold;
            font-size: 10px;
            fill: white;
        }

        /* æ‚¬åœåŠ¨ç”» */
        .marker-group:hover {
            transform: translateY(-8px) scale(1.1);
        }

        /* --- ç‚¹å‡»ç‰¹æ•ˆ: å¯çˆ±çš„ AT Field --- */
        .at-field-pulse {
            position: absolute;
            width: 120px;
            height: 120px;
            background: rgba(251, 191, 36, 0.4);
            /* Orange */
            clip-path: polygon(30% 0%, 70% 0%, 100% 30%, 100% 70%, 70% 100%, 30% 100%, 0% 70%, 0% 30%);
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            pointer-events: none;
            z-index: 0;
            border: 2px solid #fff;
        }

        .marker-group.active .at-field-pulse {
            animation: at-field-expand 1s ease-out infinite;
        }

        @keyframes at-field-expand {
            0% {
                transform: translate(-50%, -50%) scale(0.5);
                opacity: 0.8;
            }

            100% {
                transform: translate(-50%, -50%) scale(1.5);
                opacity: 0;
            }
        }

        /* --- è·¯çº¿ --- */
        .travel-line {
            stroke: #a78bfa;
            /* ç´«è‰²è·¯çº¿ */
            stroke-width: 4;
            stroke-dasharray: 10, 10;
            stroke-linecap: round;
            filter: drop-shadow(0 2px 2px rgba(0, 0, 0, 0.1));
            animation: dash 60s linear infinite;
        }

        @keyframes dash {
            to {
                stroke-dashoffset: -1000;
            }
        }

        /* --- UI é¢æ¿ --- */
        .info-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(8px);
            box-shadow: -10px 0 25px rgba(0, 0, 0, 0.05);
            border-top-left-radius: 30px;
            border-bottom-left-radius: 30px;
            transform: translateX(110%);
            transition: transform 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .info-panel.open {
            transform: translateX(0);
        }

        /* ç²‰è‰²ç´§æ€¥è­¦æŠ¥èƒ¶å¸¦ */
        .emergency-tape {
            position: absolute;
            height: 30px;
            width: 140px;
            background: repeating-linear-gradient(45deg,
                    #fce7f3,
                    #fce7f3 10px,
                    #f472b6 10px,
                    #f472b6 20px);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transform: rotate(-5deg);
            top: -15px;
            left: 50%;
            margin-left: -70px;
            z-index: 20;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 10px;
            letter-spacing: 2px;
            text-shadow: 0 1px 1px rgba(0, 0, 0, 0.2);
            border: 1px solid white;
        }

        .polaroid {
            background: white;
            padding: 8px 8px 25px 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transform: rotate(2deg);
            transition: transform 0.3s;
        }

        .polaroid:hover {
            transform: rotate(0deg) scale(1.02);
        }

        .polaroid-img {
            background-color: #f3f4f6;
            width: 100%;
            aspect-ratio: 4/3;
            overflow: hidden;
            position: relative;
        }
    </style>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
</head>

<body
    class="h-screen w-screen flex flex-col relative overflow-hidden selection:bg-purple-200 selection:text-purple-900">

    <!-- åœ°å›¾ -->
    <div id="map"></div>

    <!-- é¡¶éƒ¨ HUD: NERV è§‚å…‰è¯¾ -->
    <header class="absolute top-0 left-0 w-full p-6 z-20 pointer-events-none flex justify-between items-start">
        <div
            class="bg-white/90 px-6 py-4 rounded-3xl shadow-lg backdrop-blur-sm transform -rotate-1 border-b-4 border-green-400 pointer-events-auto transition-transform hover:scale-105 group cursor-pointer">
            <h1 class="text-3xl font-cute text-purple-600 tracking-wider flex items-center gap-3">
                <!-- ç®€åŒ–çš„æ— èŠ±æœå¶ Logo -->
                <div class="relative w-8 h-8">
                    <i class="fas fa-leaf text-red-500 text-3xl transform rotate-180"></i>
                    <div class="absolute bottom-0 w-full text-[6px] text-center font-bold text-red-500 bg-white/80">NERV
                    </div>
                </div>
                NERV è§‚å…‰ç§‘
                <span
                    class="text-sm bg-red-100 text-red-500 px-2 py-1 rounded-lg ml-2 group-hover:animate-pulse">æš‘å‡ä¸­</span>
            </h1>
        </div>
    </header>

    <!-- ä¾§è¾¹æ è¯¦æƒ… -->
    <div id="info-panel"
        class="absolute top-0 right-0 h-full w-full md:w-[420px] z-30 info-panel flex flex-col pt-24 pb-10 px-8 border-l-4 border-purple-200">
        <button onclick="closePanel()"
            class="absolute top-6 right-6 bg-gray-100 hover:bg-gray-200 text-gray-500 w-10 h-10 rounded-full flex items-center justify-center transition-colors shadow-sm">
            <i class="fas fa-times"></i>
        </button>

        <div id="panel-content" class="flex-1 overflow-y-auto pr-2 custom-scroll">
            <!-- Content -->
        </div>

        <div class="mt-auto pt-4 flex justify-center opacity-50 text-[10px] font-mono tracking-widest text-purple-400">
            GOD'S IN HIS HEAVEN. ALL'S RIGHT WITH THE WORLD.
        </div>
    </div>

    <script>
        // --- æ•°æ®é…ç½® ---
        // type å†³å®šé…è‰²: 
        // 01 = åˆå·æœº (ç´«ç»¿) - å¸‚åŒº/æ ¸å¿ƒ
        // 02 = äºŒå·æœº (çº¢æ©™) - è´­ç‰©/çƒ­é—¹
        // 00 = é›¶å·æœº (è“ç™½) - æµ·è¾¹/å®‰é™
        const locations = {
            'asakusa': {
                lat: 35.7148, lng: 139.7967,
                label: 'æµ…è‰',
                title: 'æµ…è‰ä½œæˆ˜ ğŸ®',
                unit: '02',
                tags: ['#é›·é—¨', '#è§‚å…‰', '#å’Œé£'],
                desc: 'å»ç¬¬äºŒæ–°ä¸œäº¬å¸‚ä¹‹å‰å…ˆæ¥è¿™é‡Œï¼å»ä»²è§ä¸–é€šè¡¥å……ä¸€ç‚¹èƒ½é‡ï¼ˆå›¢å­ï¼‰ğŸ¡ã€‚è¿™é‡Œå®Œå…¨ä¸ç”¨æ‹…å¿ƒä½¿å¾’æ¥è¢­ï¼'
            },
            'akihabara': {
                lat: 35.6984, lng: 139.7731,
                label: 'ç§‹å¶åŸ',
                title: 'ç§‹å¶åŸè¡¥ç»™åŸºåœ° âš¡',
                unit: '02',
                tags: ['#RADIO_EVA', '#æ‰‹åŠ'],
                desc: 'æ˜æ—¥é¦™è‚¯å®šä¼šå–œæ¬¢è¿™é‡Œï¼æ»¡è¡—éƒ½æ˜¯çº¢è‰²çš„æ‹›ç‰Œã€‚å»ã€ŒRADIO EVAã€ä¹°ä¸€å¥—æ–°çš„é©¾é©¶æœï¼ˆå…¶å®æ˜¯ç§æœï¼‰å§ã€‚'
            },
            'ikebukuro': {
                lat: 35.7295, lng: 139.7109,
                label: 'æ± è¢‹',
                title: 'EVA STORE æœ¬éƒ¨ ğŸ§',
                unit: '01',
                tags: ['#EVA_STORE', '#åœ£åœ°'],
                desc: 'è¿™é‡Œå°±æ˜¯æˆ‘ä»¬çš„å¤§æœ¬è¥ã€‚åœ¨ã€ŒEVA STORE TOKYO-01ã€å›æ”¶é™å®šé“å…·ï¼é¦–è¦ç›®æ ‡æ˜¯æ•è·ä¸€åªPenPenç©å¶ï¼'
            },
            'shinjuku': {
                lat: 35.6938, lng: 139.7035,
                label: 'æ–°å®¿',
                title: 'æ—§Â·ç¬¬ä¸‰æ–°ä¸œäº¬å¸‚? ğŸ™ï¸',
                unit: '01',
                tags: ['#ç¾é‡Œå°å§', '#å¤œæ™¯'],
                desc: 'è®©äººæƒ³å¼€ç€ç¾é‡Œå°å§çš„è½¦åœ¨è¿™é‡Œç‹‚é£™çš„è¡—é“ã€‚äººå¾ˆå¤šï¼Œè®°å¾—å…¨å¼€A.T.åŠ›åœºèµ°è·¯ã€‚æ™šä¸Šçš„éœ“è™¹ç¯å°±åƒæš´èµ°æ¨¡å¼ä¸€æ ·æ¼‚äº®ã€‚'
            },
            'shimokitazawa': {
                lat: 35.6619, lng: 139.6666,
                label: 'ä¸‹åŒ—æ³½',
                title: 'ä¸‹åŒ—æ³½äºšæ–‡åŒ–åŒº ğŸ¸',
                unit: '01',
                tags: ['#å¤ç€', '#å’–å–±'],
                desc: 'çœŸå—£å›è‚¯å®šä¼šæˆ´ç€SDATå¬ç€æ­Œåœ¨è¿™é‡Œæ•£æ­¥ã€‚è¿™é‡Œçš„å¤ç€å’Œå’–å–±ï¼ŒåŒæ­¥ç‡é«˜è¾¾400%ï¼'
            },
            'shibuya': {
                lat: 35.6580, lng: 139.7016,
                label: 'æ¶©è°·',
                title: 'æ¶©è°·åœ°ä¸‹éƒ½å¸‚ ğŸ‘—',
                unit: '02',
                tags: ['#PARCO', '#åå­—è·¯å£'],
                desc: 'å¬è¯´PARCOçš„åœ°ä¸‹ä¹Ÿæœ‰ä¸ªGeofront... è¿™é‡Œæ˜¯æœ€æ–°æ½®æµçš„å‘æºåœ°ã€‚ç©¿ä¸Šçº¢è‰²çš„è¡£æœï¼Œæ„Ÿè§‰éšæ—¶éƒ½èƒ½è¯´å‡ºé‚£å¥ã€Œä½ æ˜¯ç¬¨è›‹å—ï¼Ÿã€'
            },
            'tokyobigsight': {
                lat: 35.6298, lng: 139.7942,
                label: 'Big Sight',
                title: 'åœ£æˆ˜çš„é€†ä¸‰è§’å½¢ ğŸ“š',
                unit: '02',
                tags: ['#æ¼«å±•', '#è¦å¡'],
                desc: 'è¿™å»ºç­‘é•¿å¾—å®Œå…¨å°±æ˜¯ä¸ªä½¿å¾’ï¼ˆé›·å¤©ä½¿æ—¢è§†æ„Ÿï¼‰ã€‚å¤å†¬ä¸¤å­£ä¼šä¸¾åŠåä¸ºã€Œäººç±»è¡¥å®Œè®¡åˆ’ã€çš„å¤§å‹é›†ä¼šæ´»åŠ¨ã€‚'
            },
            'kamakura': {
                lat: 35.3192, lng: 139.5467,
                label: 'é•°ä»“',
                title: 'é•°ä»“é˜²å«çº¿ ğŸšƒ',
                unit: '00',
                tags: ['#æ±Ÿä¹‹ç”µ', '#æµ·'],
                desc: 'åä¸Šæ±Ÿä¹‹ç”µå»çœ‹æµ·ã€‚ä¸æ˜¯ç¬¬äºŒæ¬¡å†²å‡»åçš„çº¢æµ·ï¼Œè€Œæ˜¯æ¼‚äº®çš„è“æµ·å“¦ï¼æƒ³å­¦ä¸½é‚£æ ·é™é™åœ°çœ‹ç€æµ·é¢å‘å‘†ã€‚'
            },
            'shichirigahama': {
                lat: 35.3058, lng: 139.5106,
                label: 'ä¸ƒé‡Œæ»¨',
                title: 'ä¸ƒé‡Œæ»¨ ğŸ–ï¸',
                unit: '00',
                tags: ['#å¤•é˜³', '#æ•£æ­¥'],
                desc: 'ä»è¿™é‡Œçœ‹åˆ°çš„å¤•é˜³ç¾å¾—æƒŠäººï¼Œæ„Ÿè§‰è€³è¾¹è‡ªåŠ¨å“èµ·äº†ç‰‡å°¾æ›²ã€ŠFly Me To The Moonã€‹ã€‚'
            },
            'enoshima': {
                lat: 35.3017, lng: 139.4811,
                label: 'æ±Ÿä¹‹å²›',
                title: 'æ±Ÿä¹‹å²› ğŸï¸',
                unit: '00',
                tags: ['#å»ä»”é±¼ç›–é¥­', '#çŒ«'],
                desc: 'é‚£åº§é•¿æ¡¥çœ‹èµ·æ¥æœ‰ç‚¹åƒä½¿å¾’è¿å‡»ç”¨çš„è·‘é“ã€‚æ•´åº§å²›å°±åƒä¸ªå¥½ç©çš„è¿·å®«ã€‚å¦‚æœåœ¨å²›ä¸Šçœ‹åˆ°çŒ«å’ªï¼Œåƒä¸‡åˆ«ç»™å®ƒæˆ´ä½¿å¾’é¢å…·å“¦ï¼'
            }
        };

        // --- åœ°å›¾åˆå§‹åŒ– ---
        const map = L.map('map', {
            zoomControl: false,
            attributionControl: false,
            zoomSnap: 0.1
        }).setView([35.55, 139.65], 10.2);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 16,
            minZoom: 9
        }).addTo(map);

        // --- è·¯çº¿ (åˆå·æœºé…è‰²) ---
        const routePoints = [
            [locations.asakusa.lat, locations.asakusa.lng],
            [locations.akihabara.lat, locations.akihabara.lng],
            [locations.ikebukuro.lat, locations.ikebukuro.lng],
            [locations.shinjuku.lat, locations.shinjuku.lng],
            [locations.shimokitazawa.lat, locations.shimokitazawa.lng],
            [locations.shibuya.lat, locations.shibuya.lng],
            [locations.tokyobigsight.lat, locations.tokyobigsight.lng],
            [35.5, 139.7],
            [locations.kamakura.lat, locations.kamakura.lng],
            [locations.shichirigahama.lat, locations.shichirigahama.lng],
            [locations.enoshima.lat, locations.enoshima.lng]
        ];

        L.polyline(routePoints, {
            className: 'travel-line',
            smoothFactor: 2
        }).addTo(map);

        // --- æ ‡è®°ç‚¹ ---
        Object.keys(locations).forEach(key => {
            const loc = locations[key];

            // æ ‡ç­¾é¿è®©å¾®è°ƒ
            let textAnchor = 'middle';
            let tx = 0, ty = -45;

            if (['shinjuku', 'shibuya', 'shimokitazawa'].includes(key)) {
                if (key === 'shibuya') ty = 35;
                if (key === 'shimokitazawa') { tx = -45; ty = 5; textAnchor = 'end'; }
            }
            if (['kamakura', 'shichirigahama', 'enoshima'].includes(key)) {
                if (key === 'kamakura') { tx = 25; ty = -20; textAnchor = 'start'; }
                if (key === 'shichirigahama') { tx = 0; ty = 35; }
                if (key === 'enoshima') { tx = -25; ty = -20; textAnchor = 'end'; }
            }

            const unitClass = `unit-${loc.unit}`;

            // å…­è¾¹å½¢ SVG è·¯å¾„
            const hexPath = "M0,-24 L20,-12 L20,12 L0,24 L-20,12 L-20,-12 Z";
            // æŒ‡é’ˆè·¯å¾„
            const pointerPath = "M-6,20 L0,32 L6,20 Z";

            const iconHtml = `
                <svg width="120" height="120" viewBox="-60 -60 120 120" class="marker-svg">
                    <g class="marker-group ${unitClass}" id="marker-g-${key}">
                        <!-- AT Field (ç‚¹å‡»åæ˜¾ç¤º) -->
                        <foreignObject x="-60" y="-60" width="120" height="120" class="at-field-pulse">
                            <div></div>
                        </foreignObject>
                        
                        <!-- é˜´å½± -->
                        <path d="${hexPath}" fill="black" opacity="0.2" transform="translate(0, 4)" />
                        
                        <!-- å…­è¾¹å½¢ä¸»ä½“ -->
                        <g class="marker-badge">
                             <path d="${pointerPath}" class="marker-stroke" />
                             <path d="${hexPath}" class="marker-stroke" />
                             
                             <!-- å†…éƒ¨è£…é¥° -->
                             <circle cx="0" cy="0" r="14" class="marker-fill" />
                             <text x="0" y="4" text-anchor="middle" class="marker-number">${loc.unit}</text>
                        </g>

                        <!-- å¤–éƒ¨æ–‡æœ¬ -->
                        <text x="${tx}" y="${ty}" class="marker-label" text-anchor="${textAnchor}" dominant-baseline="middle">${loc.label}</text>
                    </g>
                </svg>
            `;

            const icon = L.divIcon({
                className: 'eva-marker-icon',
                html: iconHtml,
                iconSize: [120, 120],
                iconAnchor: [60, 60]
            });

            L.marker([loc.lat, loc.lng], { icon: icon })
                .addTo(map)
                .on('click', () => selectLocation(key));
        });

        // --- äº¤äº’é€»è¾‘ ---
        function selectLocation(key) {
            const data = locations[key];
            const panel = document.getElementById('info-panel');
            const content = document.getElementById('panel-content');

            // 1. æ¿€æ´»æ ‡è®°
            document.querySelectorAll('.marker-group').forEach(el => el.classList.remove('active'));
            const activeEl = document.querySelector(`#marker-g-${key}`);
            if (activeEl) activeEl.classList.add('active');

            // 2. æ›´æ–°é¢æ¿
            const bgClass = data.unit === '01' ? 'bg-purple-50' : (data.unit === '02' ? 'bg-red-50' : 'bg-blue-50');
            const titleColor = data.unit === '01' ? 'text-purple-600' : (data.unit === '02' ? 'text-red-600' : 'text-blue-600');

            content.innerHTML = `
                <div class="mb-6 relative">
                    <h2 class="text-3xl font-cute ${titleColor} mb-2">${data.title}</h2>
                    <div class="flex flex-wrap gap-2">
                        ${data.tags.map(tag => `<span class="px-2 py-1 bg-white border border-gray-100 rounded-lg text-xs text-gray-500 font-bold shadow-sm">${tag}</span>`).join('')}
                    </div>
                </div>

                <!-- æ‹ç«‹å¾—ç…§ç‰‡ -->
                <div class="relative mb-8 mx-2">
                    <div class="emergency-tape">EMERGENCY</div>
                    <div class="polaroid">
                        <div class="polaroid-img flex items-center justify-center text-gray-300">
                             <!-- è£…é¥°å›¾æ ‡ -->
                             <div class="text-center">
                                <i class="fas fa-camera text-4xl mb-2 opacity-30"></i>
                                <div class="text-[10px] font-bold opacity-50 font-mono">IMG_UNIT_${data.unit}.JPG</div>
                             </div>
                        </div>
                        <div class="pt-3 pb-1 text-center font-cute text-gray-500 text-sm -rotate-1">
                            åœ¨${data.label}ï¼Œå’Œä½¿å¾’åˆå½±ç•™å¿µâœŒï¸
                        </div>
                    </div>
                </div>

                <!-- æè¿° -->
                <div class="${bgClass} p-6 rounded-2xl relative shadow-sm border border-white">
                    <i class="fas fa-quote-left text-2xl text-white absolute -top-3 -left-2 drop-shadow-md"></i>
                    <p class="text-gray-600 font-cute leading-7 text-sm">
                        ${data.desc}
                    </p>
                </div>

                <div class="mt-8 flex justify-between items-center text-xs text-gray-400 font-bold font-mono">
                    <span>SYNC RATE: ${Math.floor(Math.random() * 60 + 40)}%</span>
                    <span>MAGI-SYS: GO</span>
                </div>
            `;

            panel.classList.add('open');

            map.flyTo([data.lat, data.lng], 13, {
                animate: true,
                duration: 1.2,
                paddingBottomRight: [300, 0]
            });
        }

        function closePanel() {
            document.getElementById('info-panel').classList.remove('open');
            document.querySelectorAll('.marker-group').forEach(el => el.classList.remove('active'));
            map.flyTo([35.55, 139.65], 10.2, { duration: 1.5 });
        }
    </script>
</body>

</html>