<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MAGI INTELLIGENCE | 機密情報解析</title>
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="./favicon.svg">
    
    <!-- Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Fonts: Noto Serif SC (EVA Title), JetBrains Mono (Code) -->
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700;800&family=Noto+Serif+SC:wght@700;900&family=Noto+Sans+JP:wght@400;700;900&display=swap" rel="stylesheet">

    <!-- Tailwind Config -->
    <script>
        window.tailwind = window.tailwind || {};
        window.tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        magi_red: '#ff2a2a',     /* 警报红 */
                        magi_orange: '#ffae00',  /* 琥珀橙 */
                        magi_dark: '#1a0505',    /* 深红黑背景 */
                        terminal_black: '#0a0a0a'
                    },
                    fontFamily: { 
                        mono: ['JetBrains Mono', 'monospace'],
                        serif: ['Noto Serif SC', 'serif'],
                        jp: ['Noto Sans JP', 'sans-serif']
                    },
                    animation: {
                        'scan-vertical': 'scanVertical 3s linear infinite',
                        'flash-alert': 'flashAlert 1s infinite',
                        'hex-spin': 'hexSpin 1s linear infinite',
                    },
                    keyframes: {
                        scanVertical: {
                            '0%': { backgroundPosition: '0 0' },
                            '100%': { backgroundPosition: '0 100%' }
                        },
                        flashAlert: {
                            '0%, 100%': { opacity: 1 },
                            '50%': { opacity: 0.3 }
                        },
                        hexSpin: {
                            '0%': { transform: 'rotate(0deg)' },
                            '100%': { transform: 'rotate(360deg)' }
                        }
                    }
                }
            }
        }
    </script>

    <style>
        /* --- GLOBAL STYLES --- */
        body { 
            background-color: #050101; 
            color: #ffae00; 
            font-family: 'JetBrains Mono', monospace; 
            overflow-x: hidden;
            background-image: 
                linear-gradient(rgba(255, 42, 42, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 42, 42, 0.03) 1px, transparent 1px);
            background-size: 30px 30px;
        }

        /* --- EVA TYPOGRAPHY --- */
        .eva-title {
            font-family: 'Noto Serif SC', serif;
            font-weight: 900;
            transform: scaleY(1.2); /* 经典的EVA字体拉伸 */
            letter-spacing: -0.05em;
        }
        
        .eva-subtitle {
            font-family: 'JetBrains Mono', monospace;
            letter-spacing: 0.2em;
            font-size: 0.6rem;
            opacity: 0.7;
        }

        /* --- UI COMPONENTS --- */
        /* Hexagon Clip Path */
        .hex-border {
            clip-path: polygon(10px 0, 100% 0, 100% calc(100% - 10px), calc(100% - 10px) 100%, 0 100%, 0 10px);
            border: 1px solid #ffae00; /* Fallback */
        }

        /* Magi Panel */
        .magi-panel {
            background: rgba(20, 5, 5, 0.85);
            border: 1px solid #ffae00;
            border-left: 4px solid #ffae00;
            box-shadow: 0 0 15px rgba(255, 174, 0, 0.1);
            backdrop-filter: blur(5px);
            position: relative;
            transition: all 0.3s ease;
        }
        .magi-panel:hover {
            box-shadow: 0 0 25px rgba(255, 174, 0, 0.2);
            border-color: #ffca28;
        }
        /* Corner Decorations */
        .magi-panel::before { content: ''; position: absolute; top: -1px; right: -1px; width: 10px; height: 10px; border-top: 2px solid #ffae00; border-right: 2px solid #ffae00; }
        .magi-panel::after { content: ''; position: absolute; bottom: -1px; left: -1px; width: 10px; height: 10px; border-bottom: 2px solid #ffae00; border-left: 2px solid #ffae00; }

        /* Inputs */
        .magi-input {
            background: rgba(0,0,0,0.6);
            border: 1px solid #555;
            border-bottom: 2px solid #ffae00;
            color: #fff;
            font-family: 'JetBrains Mono', monospace;
            transition: all 0.3s;
        }
        .magi-input:focus {
            outline: none;
            border-color: #ff2a2a;
            box-shadow: 0 0 15px rgba(255, 42, 42, 0.3);
            background: rgba(255, 42, 42, 0.05);
        }

        /* Buttons (Tactical Style) */
        .magi-btn {
            background: #ffae00;
            color: #000;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 1px;
            clip-path: polygon(10px 0, 100% 0, 100% 100%, 0 100%, 0 10px);
            transition: all 0.2s;
            position: relative;
            overflow: hidden;
        }
        .magi-btn:hover {
            background: #fff;
            box-shadow: 0 0 15px #fff;
        }
        .magi-btn:active { transform: scale(0.98); }

        /* Red Button Variant */
        .magi-btn-red { background: #ff2a2a; color: #fff; }
        .magi-btn-red:hover { background: #ff5555; color: #000; box-shadow: 0 0 15px #ff2a2a; }

        /* --- ANIMATIONS --- */
        .loading-overlay {
            background: repeating-linear-gradient(
                0deg,
                rgba(0, 0, 0, 0.9),
                rgba(0, 0, 0, 0.9) 2px,
                rgba(255, 174, 0, 0.05) 3px
            );
            background-size: 100% 4px;
        }
        
        .scan-bar {
            width: 100%; height: 2px;
            background: #ffae00;
            box-shadow: 0 0 10px #ffae00;
            animation: scanVertical 2s linear infinite;
        }

        /* Hex Spinner */
        .hex-spinner {
            width: 50px; height: 50px;
            border: 4px solid #ffae00;
            border-top-color: transparent;
            border-bottom-color: transparent;
            animation: hex-spin 1s infinite linear;
        }

        /* --- RESPONSIVE FIXES --- */
        @media (max-width: 768px) {
            .eva-title { transform: scaleY(1.1); }
        }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #0a0a0a; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #ffae00; }
    </style>
</head>
<body class="antialiased selection:bg-magi_red selection:text-white">

    <!-- 1. NAVIGATION (Back to Central Dogma) -->
    <nav class="fixed top-0 left-0 w-full z-50 p-4 pointer-events-none">
        <a href="index.html" class="pointer-events-auto inline-flex items-center gap-2 bg-black/80 border border-magi_orange px-4 py-2 text-xs font-bold text-magi_orange hover:bg-magi_orange hover:text-black transition-all hex-border group">
            <i data-lucide="arrow-left" class="w-4 h-4 group-hover:-translate-x-1 transition-transform"></i>
            <span>作戦中止 (ABORT)</span>
        </a>
    </nav>

    <!-- 2. MAIN CONTAINER -->
    <main class="min-h-screen pt-20 pb-12 px-4 md:px-8 max-w-7xl mx-auto">
        
        <!-- HEADER SECTION -->
        <header class="flex flex-col md:flex-row items-start md:items-end justify-between border-b-4 border-magi_red pb-6 mb-10 gap-4">
            <div>
                <div class="flex items-center gap-3 mb-1">
                    <div class="w-3 h-3 bg-magi_red animate-flash-alert"></div>
                    <span class="text-xs text-magi_red font-mono tracking-widest">MAGI SYSTEM / DIV.2</span>
                </div>
                <h1 class="text-6xl md:text-8xl text-magi_red eva-title drop-shadow-[0_0_10px_rgba(255,42,42,0.5)]">諜報部</h1>
                <p class="text-magi_orange eva-subtitle mt-2">INTELLIGENCE DIVISION // DATA ANALYSIS</p>
            </div>
            
            <div class="text-right hidden md:block">
                <div class="text-4xl eva-title text-magi_orange font-bold">CODE: 893</div>
                <div class="text-xs text-magi_red mt-1 font-bold">PATTERN: BLUE (Unidentified)</div>
            </div>
        </header>

        <!-- DASHBOARD GRID -->
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
            
            <!-- LEFT: INPUT TERMINALS -->
            <div class="lg:col-span-4 space-y-6">
                
                <!-- MODULE 1: HASH DECRYPTOR (Red Theme) -->
                <div class="magi-panel p-6" style="border-color: #ff2a2a; border-left-width: 6px;">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-xl text-magi_red eva-title flex items-center gap-2">
                            <i data-lucide="lock" class="w-5 h-5"></i> 暗号解読
                        </h3>
                        <span class="text-[10px] bg-magi_red/20 text-magi_red px-2 py-1">DANMAKU</span>
                    </div>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="text-[10px] text-gray-500 font-mono block mb-1">ENCRYPTED_HASH (CRC32)</label>
                            <input type="text" id="hash-input" class="magi-input w-full p-3 text-sm" placeholder="例: 89b3f9a2">
                        </div>
                        <button onclick="resolveHash()" class="magi-btn magi-btn-red w-full p-3">
                            解析開始 (DECRYPT)
                        </button>
                    </div>
                    <div class="mt-4 pt-4 border-t border-magi_red/30 text-[10px] text-magi_red/70 font-mono">
                        > BRUTE FORCE ENGINE: READY<br>
                        > CONNECTING TO RAINBOW TABLE...
                    </div>
                </div>

                <!-- MODULE 2: PILOT SCANNER (Orange Theme) -->
                <div class="magi-panel p-6">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-xl text-magi_orange eva-title flex items-center gap-2">
                            <i data-lucide="scan-face" class="w-5 h-5"></i> 適格者調査
                        </h3>
                        <span class="text-[10px] bg-magi_orange/20 text-magi_orange px-2 py-1">USER_SCAN</span>
                    </div>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="text-[10px] text-gray-500 font-mono block mb-1">PILOT_ID (UID)</label>
                            <input type="text" id="uid-input" class="magi-input w-full p-3 text-sm" placeholder="例: 551898501">
                        </div>
                        <button onclick="scanUser()" class="magi-btn w-full p-3">
                            スキャン (SCAN)
                        </button>
                    </div>
                </div>

                <!-- MODULE 3: ARCHIVE VIEWER (Orange Theme) -->
                <div class="magi-panel p-6">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-xl text-magi_orange eva-title flex items-center gap-2">
                            <i data-lucide="film" class="w-5 h-5"></i> 記録映像
                        </h3>
                        <span class="text-[10px] bg-magi_orange/20 text-magi_orange px-2 py-1">ARCHIVE</span>
                    </div>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="text-[10px] text-gray-500 font-mono block mb-1">ARCHIVE_ID (BV)</label>
                            <input type="text" id="bv-input" class="magi-input w-full p-3 text-sm" placeholder="例: BV1xx411c7X7">
                        </div>
                        <button onclick="scanVideo()" class="magi-btn w-full p-3">
                            再生 (ACCESS)
                        </button>
                    </div>
                </div>

            </div>

            <!-- RIGHT: DISPLAY TERMINAL -->
            <div class="lg:col-span-8">
                <div id="main-display" class="magi-panel h-full min-h-[600px] bg-black relative overflow-hidden flex flex-col">
                    
                    <!-- 1. IDLE SCREEN (Default) -->
                    <div id="screen-idle" class="absolute inset-0 flex flex-col items-center justify-center opacity-50 pointer-events-none">
                        <div class="w-32 h-32 border-2 border-dashed border-magi_red rounded-full animate-spin-slow flex items-center justify-center mb-6">
                            <i data-lucide="radar" class="w-12 h-12 text-magi_red"></i>
                        </div>
                        <h2 class="text-3xl eva-title text-magi_red mb-2">待機中</h2>
                        <p class="font-mono text-xs text-magi_orange tracking-widest">AWAITING DATA INJECTION...</p>
                    </div>

                    <!-- 2. LOADING OVERLAY (Hidden) -->
                    <div id="screen-loading" class="hidden absolute inset-0 z-50 loading-overlay flex-col items-center justify-center">
                        <div class="hex-spinner mb-8"></div>
                        <h2 class="text-4xl eva-title text-magi_orange animate-pulse">解析中...</h2>
                        <div class="font-mono text-sm text-magi_red mt-4">
                            SYNC RATE: <span id="sync-text">00.0</span>%
                        </div>
                        <!-- Decoding Text Effect -->
                        <div class="mt-8 font-mono text-xs text-gray-500 w-64 text-center overflow-hidden whitespace-nowrap">
                            DECODING: <span id="decode-hash">XF-99-AZ-00</span>
                        </div>
                    </div>

                    <!-- 3. RESULT: HASH DECRYPT (Hidden) -->
                    <div id="result-hash" class="hidden p-8 h-full overflow-y-auto relative z-10 animate-pulse-in">
                        <div class="border-l-4 border-magi_red pl-6 mb-8">
                            <h2 class="text-4xl text-white eva-title">解読成功</h2>
                            <p class="text-magi_red font-mono text-xs mt-1">DECRYPTION COMPLETE</p>
                        </div>

                        <div class="bg-magi_red/10 border border-magi_red p-8 flex flex-col md:flex-row items-center justify-between gap-8 mb-8">
                            <div class="text-center md:text-left">
                                <div class="text-xs text-magi_red mb-2 font-mono">TARGET HASH</div>
                                <div id="res-hash-val" class="text-2xl font-bold font-mono text-white">UNKNOWN</div>
                            </div>
                            
                            <i data-lucide="arrow-right" class="w-8 h-8 text-magi_red hidden md:block"></i>
                            <i data-lucide="arrow-down" class="w-8 h-8 text-magi_red md:hidden"></i>

                            <div class="text-center md:text-right">
                                <div class="text-xs text-[#39ff14] mb-2 font-mono">REAL UID</div>
                                <div id="res-uid-val" class="text-5xl font-black font-mono text-[#39ff14] drop-shadow-[0_0_15px_#39ff14]">UNKNOWN</div>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <button onclick="jumpToUser()" class="magi-btn flex items-center justify-center gap-2 py-4">
                                <i data-lucide="external-link" class="w-4 h-4"></i> 対象の空間へ転送
                            </button>
                            <button onclick="copyUid()" class="magi-btn magi-btn-red flex items-center justify-center gap-2 py-4">
                                <i data-lucide="copy" class="w-4 h-4"></i> UID コピー
                            </button>
                        </div>
                    </div>

                    <!-- 4. RESULT: USER INFO (Hidden) -->
                    <div id="result-user" class="hidden p-8 h-full overflow-y-auto relative z-10">
                        <div class="flex flex-col md:flex-row items-start gap-8 mb-8 border-b border-magi_orange/30 pb-8">
                            <div class="relative shrink-0 mx-auto md:mx-0">
                                <img id="u-face" src="" class="w-32 h-32 object-cover border-2 border-magi_orange shadow-[0_0_20px_rgba(255,174,0,0.3)] bg-black">
                                <div class="absolute -bottom-3 -right-3 bg-black border border-magi_orange px-2 py-1 text-xs font-bold text-magi_orange">
                                    LV.<span id="u-level">0</span>
                                </div>
                            </div>
                            <div class="flex-1 text-center md:text-left">
                                <div class="flex flex-wrap items-center justify-center md:justify-start gap-4 mb-3">
                                    <h2 id="u-name" class="text-3xl md:text-4xl font-black text-white eva-title">UNKNOWN</h2>
                                    <span id="u-sex" class="text-xs border border-white/30 px-2 py-0.5 text-gray-400 font-mono">?</span>
                                </div>
                                <div class="font-mono text-sm text-magi_red mb-4">UID: <span id="u-mid">000000</span></div>
                                <p id="u-sign" class="text-sm text-gray-300 bg-white/5 p-4 border-l-2 border-magi_orange italic rounded-r font-sans">
                                    No signature data available.
                                </p>
                            </div>
                        </div>

                        <div class="grid grid-cols-2 gap-4 mb-8">
                            <div class="bg-black/40 border border-magi_orange p-4 text-center hover:bg-magi_orange/10 transition-colors">
                                <div class="text-xs text-gray-500 mb-1">FOLLOWER</div>
                                <div id="u-fans" class="text-3xl font-bold text-magi_orange font-mono">0</div>
                            </div>
                            <div class="bg-black/40 border border-magi_orange p-4 text-center hover:bg-magi_orange/10 transition-colors">
                                <div class="text-xs text-gray-500 mb-1">FRIEND</div>
                                <div id="u-friend" class="text-3xl font-bold text-magi_orange font-mono">0</div>
                            </div>
                        </div>

                        <div class="h-64 w-full relative bg-black/20 rounded border border-white/5 p-2">
                            <canvas id="userRadar"></canvas>
                        </div>
                    </div>

                    <!-- 5. RESULT: VIDEO INFO (Hidden) -->
                    <div id="result-video" class="hidden relative h-full w-full flex flex-col">
                        <div class="absolute inset-0 z-0">
                            <img id="v-pic-bg" src="" class="w-full h-full object-cover opacity-20 blur-sm">
                            <div class="absolute inset-0 bg-gradient-to-t from-black via-black/90 to-transparent"></div>
                        </div>
                        
                        <div class="relative z-10 p-8 h-full flex flex-col justify-end space-y-6">
                            <div class="border-l-4 border-magi_orange pl-6">
                                <h2 id="v-title" class="text-2xl md:text-4xl font-black text-white leading-tight eva-title mb-2 drop-shadow-lg line-clamp-2">TITLE</h2>
                                <p class="text-magi_orange font-bold flex items-center gap-2">
                                    <i data-lucide="user" class="w-4 h-4"></i> 
                                    UP: <span id="v-author-text">UNKNOWN</span>
                                </p>
                            </div>

                            <div class="grid grid-cols-4 gap-2 text-center text-xs font-mono">
                                <div class="bg-white/5 p-3 border-t-2 border-magi_red backdrop-blur-sm">
                                    <div class="text-gray-400 mb-1">VIEW</div>
                                    <div id="v-view" class="text-white font-bold text-lg">0</div>
                                </div>
                                <div class="bg-white/5 p-3 border-t-2 border-magi_orange backdrop-blur-sm">
                                    <div class="text-gray-400 mb-1">DM</div>
                                    <div id="v-danmaku" class="text-white font-bold text-lg">0</div>
                                </div>
                                <div class="bg-white/5 p-3 border-t-2 border-magi_orange backdrop-blur-sm">
                                    <div class="text-gray-400 mb-1">REPLY</div>
                                    <div id="v-reply" class="text-white font-bold text-lg">0</div>
                                </div>
                                <div class="bg-white/5 p-3 border-t-2 border-magi_orange backdrop-blur-sm">
                                    <div class="text-gray-400 mb-1">LIKE</div>
                                    <div id="v-like" class="text-white font-bold text-lg">0</div>
                                </div>
                            </div>
                            
                            <div class="p-4 bg-black/60 border border-white/10 text-xs text-gray-300 max-h-40 overflow-y-auto font-sans custom-scrollbar" id="v-desc">
                                Description...
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </main>

    <!-- LOGIC SCRIPT -->
    <script>
        lucide.createIcons();
        
        /* ==========================================================================
           ⚠️ IMPORTANT CONFIGURATION
           Please replace the URL below with your deployed Cloudflare Worker URL
           ==========================================================================
        */
        const API_BASE = 'https://magi-intel.whte97284.workers.dev'; 

        /* DOM Elements */
        const els = {
            screens: {
                idle: document.getElementById('screen-idle'),
                loading: document.getElementById('screen-loading'),
                hash: document.getElementById('result-hash'),
                user: document.getElementById('result-user'),
                video: document.getElementById('result-video'),
            },
            stats: {
                syncText: document.getElementById('sync-text'),
                decodeText: document.getElementById('decode-hash')
            }
        };

        /* State Management */
        function switchScreen(screenName) {
            // Hide all
            Object.values(els.screens).forEach(el => el.classList.add('hidden'));
            // Show target
            if (els.screens[screenName]) els.screens[screenName].classList.remove('hidden');
        }

        /* Loading Animation Control */
        let loadingInterval;
        function startLoading() {
            switchScreen('loading');
            let rate = 0;
            const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";
            
            if (loadingInterval) clearInterval(loadingInterval);
            
            loadingInterval = setInterval(() => {
                // Update Sync Rate
                rate += Math.random() * 5;
                if (rate > 99.9) rate = 99.9;
                els.stats.syncText.innerText = rate.toFixed(1);
                
                // Update Decoding Text
                let randomHash = "";
                for(let i=0; i<12; i++) randomHash += chars.charAt(Math.floor(Math.random() * chars.length));
                els.stats.decodeText.innerText = `DECODING: ${randomHash}`;
            }, 50);
        }

        function stopLoading() {
            if (loadingInterval) clearInterval(loadingInterval);
            els.stats.syncText.innerText = "100.0";
        }

        /* API Fetcher */
        async function fetchProxy(target, id) {
            try {
                const res = await fetch(`${API_BASE}?target=${target}&id=${id}`, { method: 'POST' });
                if (!res.ok) throw new Error(`HTTP ${res.status}`);
                return await res.json();
            } catch (e) {
                console.error(e);
                alert('MAGI NETWORK ERROR: ' + e.message);
                switchScreen('idle');
                return null;
            }
        }

        /* --- FEATURE 1: HASH RESOLVE --- */
        let lastResolvedUid = '';
        
        async function resolveHash() {
            const hash = document.getElementById('hash-input').value.trim();
            if(!hash) return;
            
            startLoading();
            
            // Artificial delay for cinematic effect
            await new Promise(r => setTimeout(r, 1000));
            
            const data = await fetchProxy('hash_resolve', hash);
            stopLoading();

            if (data && data.code === 0) {
                document.getElementById('res-hash-val').innerText = data.data.hash;
                document.getElementById('res-uid-val').innerText = data.data.uid;
                lastResolvedUid = data.data.uid;
                switchScreen('hash');
            } else {
                alert('DECRYPTION FAILED (解読不能)');
                switchScreen('idle');
            }
        }

        function jumpToUser() {
            if(lastResolvedUid) window.open(`https://space.bilibili.com/${lastResolvedUid}`, '_blank');
        }
        
        function copyUid() {
            if(lastResolvedUid) {
                navigator.clipboard.writeText(lastResolvedUid);
                alert('COPIED TO CLIPBOARD');
            }
        }

        /* --- FEATURE 2: USER SCAN --- */
        async function scanUser() {
            const uid = document.getElementById('uid-input').value.trim();
            if(!uid) return;
            
            startLoading();
            
            const [cardData, statData] = await Promise.all([
                fetchProxy('user', uid),
                fetchProxy('stat', uid)
            ]);

            stopLoading();

            if (cardData && cardData.code === 0) {
                const card = cardData.data.card;
                const stat = statData.data || { follower: 0, following: 0 };

                document.getElementById('u-face').src = card.face;
                document.getElementById('u-name').innerText = card.name;
                document.getElementById('u-sex').innerText = card.sex === '男' ? 'MALE' : (card.sex === '女' ? 'FEMALE' : '?');
                document.getElementById('u-level').innerText = card.level_info.current_level;
                document.getElementById('u-mid').innerText = card.mid;
                document.getElementById('u-sign').innerText = card.sign || 'NO DATA';
                document.getElementById('u-fans').innerText = formatNum(stat.follower);
                document.getElementById('u-friend').innerText = formatNum(stat.following);

                switchScreen('user');
                renderRadar(card.level_info.current_level, stat.follower, stat.following);
            } else {
                alert('TARGET NOT FOUND (目標消失)');
                switchScreen('idle');
            }
        }

        /* --- FEATURE 3: VIDEO SCAN --- */
        async function scanVideo() {
            const bv = document.getElementById('bv-input').value.trim();
            if(!bv) return;
            
            startLoading();
            
            const data = await fetchProxy('video', bv);
            stopLoading();

            if (data && data.code === 0) {
                const v = data.data;
                document.getElementById('v-pic-bg').src = v.pic;
                document.getElementById('v-title').innerText = v.title;
                document.getElementById('v-author-text').innerText = v.owner.name;
                document.getElementById('v-view').innerText = formatNum(v.stat.view);
                document.getElementById('v-danmaku').innerText = formatNum(v.stat.danmaku);
                document.getElementById('v-reply').innerText = formatNum(v.stat.reply);
                document.getElementById('v-like').innerText = formatNum(v.stat.like);
                document.getElementById('v-desc').innerText = v.desc || 'No Description Available.';

                switchScreen('video');
            } else {
                alert('ARCHIVE CORRUPTED (データ破損)');
                switchScreen('idle');
            }
        }

        /* Utilities */
        function formatNum(num) {
            if (num > 10000) return (num/10000).toFixed(1) + '万';
            return num;
        }

        /* Radar Chart Logic */
        let chartInstance = null;
        function renderRadar(level, fans, following) {
            const ctx = document.getElementById('userRadar').getContext('2d');
            if(chartInstance) chartInstance.destroy();

            // Calculate mock stats for visualization
            const syncRate = Math.min(level * 16, 100);
            const atField = Math.min(fans / 50, 100);
            const link = Math.min(following / 5, 100);
            
            chartInstance = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['SYNC (LV)', 'AT FIELD (FANS)', 'LINK (FRIEND)', 'CHAOS', 'LCL'],
                    datasets: [{
                        label: 'PILOT STATS',
                        data: [syncRate, atField, link, 65, 80], // Mock values for Chaos/LCL
                        backgroundColor: 'rgba(255, 174, 0, 0.2)',
                        borderColor: '#ffae00',
                        borderWidth: 2,
                        pointBackgroundColor: '#fff',
                        pointBorderColor: '#ffae00',
                        pointRadius: 3
                    }]
                },
                options: {
                    scales: {
                        r: {
                            angleLines: { color: 'rgba(255,42,42,0.3)' },
                            grid: { color: 'rgba(255,42,42,0.3)' },
                            pointLabels: { 
                                color: '#ff2a2a', 
                                font: { family: 'JetBrains Mono', size: 10, weight: 'bold' } 
                            },
                            ticks: { display: false, backdropColor: 'transparent' },
                            suggestedMin: 0,
                            suggestedMax: 100
                        }
                    },
                    plugins: { legend: { display: false } },
                    maintainAspectRatio: false
                }
            });
        }
    </script>
</body>
</html>
