<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MAGI ARCHIVE | TACTICAL READER</title>
    <link rel="icon" type="image/svg+xml" href="./favicon.svg">

    <!-- [STABILITY] Âõ∫ÂÆöÁâàÊú¨Âè∑Èò≤Ê≠¢Á™ÅÁÑ∂Êõ¥Êñ∞ÂØºËá¥Ê†∑ÂºèÂ§±Êïà -->
    <script src="https://cdn.tailwindcss.com/3.4.0"></script>
    <script src="https://unpkg.com/lucide@0.294.0"></script>

    <link
        href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700;800&family=Space+Grotesk:wght@300;500;700;900&family=Noto+Sans+JP:wght@400;700;900&family=Noto+Serif+SC:wght@400;700;900&family=Noto+Sans+SC:wght@300;400;500;700&display=swap"
        rel="stylesheet">

    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

    <script>
        window.tailwind = window.tailwind || {};
        window.tailwind.config = {
            darkMode: ['class', '[data-mode="light"]'],
            theme: {
                extend: {
                    colors: { primary: 'var(--primary-color)', secondary: 'var(--secondary-color)', bg: 'var(--bg-color)' },
                    fontFamily: {
                        sans: ['Space Grotesk', 'Noto Sans JP', 'Noto Sans SC', 'sans-serif'],
                        serif: ['Noto Serif SC', 'serif'],
                        mono: ['JetBrains Mono', 'monospace']
                    },
                    animation: { 'scan': 'scan 4s linear infinite' }
                }
            }
        }
    </script>

    <style>
        /* --- Ê†∏ÂøÉÂèòÈáè --- */
        :root {
            --primary-color: #b15dff;
            --secondary-color: #39ff14;
            --bg-color: #0f0518;
            --text-main: #c0c0c0;
            --text-muted: #666;
            --glass-bg: rgba(10, 10, 12, 0.75);
            --glass-border: rgba(255, 255, 255, 0.08);
            --widget-bg: rgba(0, 0, 0, 0.4);
            --code-bg: #0b0b0b;
            --hud-opacity: 0.5;
            --nav-height: 4rem;
        }

        [data-mode="light"] {
            --bg-color: #f2f2f5;
            --text-main: #1a1a1a;
            --text-muted: #888;
            --glass-bg: rgba(255, 255, 255, 0.9);
            --glass-border: rgba(0, 0, 0, 0.05);
            --widget-bg: rgba(255, 255, 255, 0.6);
            --code-bg: #1e1e1e;
            --hud-opacity: 0.8;
        }

        [data-theme="unit-02"] {
            --primary-color: #ffae00;
            --secondary-color: #d90000;
        }

        [data-mode="light"][data-theme="unit-02"] {
            --bg-color: #fff5f5;
        }

        [data-theme="unit-00"] {
            --primary-color: #0056b3;
            --secondary-color: #0091ff;
        }

        [data-mode="light"][data-theme="unit-00"] {
            --bg-color: #f0f8ff;
        }

        /* --- Âü∫Á°ÄÈáçÁΩÆ --- */
        body {
            background-color: var(--bg-color);
            color: var(--text-main);
            font-family: 'Space Grotesk', 'Noto Sans SC', sans-serif;
            background-image: radial-gradient(circle at 50% 0%, rgba(var(--secondary-color), 0.05) 0%, transparent 60%), linear-gradient(var(--glass-border) 1px, transparent 1px), linear-gradient(90deg, var(--glass-border) 1px, transparent 1px);
            background-size: 100% 100%, 40px 40px, 40px 40px;
            background-attachment: fixed;
            overflow-x: hidden;
            margin: 0;
            padding: 0;
            transition: background-color 0.5s ease, color 0.3s ease;
        }

        /* --- Ê†∏ÂøÉ‰øÆÂ§çÔºöÊâãÂä®ÂÆûÁé∞ÂØºËà™Ê†èÂ∏ÉÂ±Ä (ËÑ±Á¶ª Tailwind ‰æùËµñ) --- */
        .tactical-nav {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: var(--nav-height);
            background: rgba(var(--bg-color), 0.9);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 1.5rem;
            box-sizing: border-box;
            /* Èò≤Ê≠¢paddingÊíëÂ§ßÂÆΩÂ∫¶ */
        }

        .nav-group {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .nav-btn-link {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--text-muted);
            text-decoration: none;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.75rem;
            font-weight: bold;
            transition: color 0.2s;
            cursor: pointer;
        }

        .nav-btn-link:hover {
            color: var(--secondary-color);
        }

        .nav-btn-link svg {
            width: 16px;
            height: 16px;
            flex-shrink: 0;
        }

        /* Âº∫Âà∂ÂõæÊ†áÂ∞∫ÂØ∏ */

        /* --- Ê†∏ÂøÉ‰øÆÂ§çÔºöÈò≤Ê≠¢ÂõæÊ†áË¢´Êå§Âéã (ÂÖ®Â±ÄÁîüÊïà) --- */
        svg.lucide {
            flex-shrink: 0 !important;
            min-width: 1em;
            min-height: 1em;
            display: inline-block;
            vertical-align: middle;
        }

        /* --- Â∏ÉÂ±ÄÁ≥ªÁªü (Grid Layout) --- */
        .tactical-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 2rem;
            max-width: 1400px;
            margin: 0 auto;
            position: relative;
            padding-top: calc(var(--nav-height) + 2rem);
            /* ÁïôÂá∫ÂØºËà™Ê†èÈ´òÂ∫¶ */
            padding-bottom: 5rem;
            padding-left: 1rem;
            padding-right: 1rem;
        }

        /* PCÁ´Ø‰∏âÊ†èÂ∏ÉÂ±Ä */
        @media (min-width: 1280px) {
            .tactical-grid {
                grid-template-columns: 280px minmax(0, 1fr) 280px;
                align-items: start;
            }

            .sidebar-left {
                position: sticky;
                top: 6rem;
                height: calc(100vh - 8rem);
                overflow-y: auto;
                padding-right: 10px;
            }

            .sidebar-right {
                position: sticky;
                top: 6rem;
                height: calc(100vh - 8rem);
            }
        }

        /* ÁßªÂä®Á´ØÈöêËóè‰æßËæπÊ†è */
        @media (max-width: 1279px) {

            .sidebar-left,
            .sidebar-right {
                display: none;
            }
        }

        /* --- Widget ÈÄöÁî®Ê†∑Âºè --- */
        .widget-card {
            background: var(--widget-bg);
            border: 1px solid var(--glass-border);
            border-left: 2px solid var(--glass-border);
            backdrop-filter: blur(8px);
            padding: 1.25rem;
            margin-bottom: 1.5rem;
            position: relative;
            transition: all 0.3s;
        }

        .widget-card:hover {
            border-left-color: var(--secondary-color);
            border-color: rgba(var(--secondary-color), 0.3);
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
        }

        .widget-header {
            font-family: 'JetBrains Mono';
            font-size: 10px;
            color: var(--secondary-color);
            margin-bottom: 1rem;
            letter-spacing: 0.1em;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px dashed var(--glass-border);
            padding-bottom: 0.5rem;
            white-space: nowrap;
        }

        /* Widget 1: Pilot Data */
        .pilot-avatar-so {
            width: 48px;
            height: 48px;
            background: #000;
            border: 1px solid var(--secondary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'JetBrains Mono';
            font-weight: bold;
            font-size: 8px;
            color: var(--secondary-color);
            text-align: center;
            box-shadow: 0 0 5px rgba(var(--secondary-color), 0.3);
            flex-shrink: 0;
        }

        .pilot-info {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .sync-bar-container {
            height: 4px;
            background: rgba(255, 255, 255, 0.1);
            margin-top: 8px;
            overflow: hidden;
        }

        .sync-bar-fill {
            height: 100%;
            background: var(--secondary-color);
            width: 85%;
            animation: pulse-width 3s infinite ease-in-out;
        }

        @keyframes pulse-width {

            0%,
            100% {
                width: 85%;
                opacity: 0.8;
            }

            50% {
                width: 95%;
                opacity: 1;
                box-shadow: 0 0 10px var(--secondary-color);
            }
        }

        /* Widget 2: Ops Controls */
        .ops-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.5rem;
        }

        .ops-btn {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--glass-border);
            color: var(--text-muted);
            font-family: 'JetBrains Mono';
            font-size: 10px;
            padding: 0.5rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            overflow: hidden;
        }

        .ops-btn:hover {
            background: var(--secondary-color);
            color: #000;
            border-color: var(--secondary-color);
        }

        .ops-btn.active {
            background: var(--primary-color);
            color: #fff;
            border-color: var(--primary-color);
        }

        /* Widget 3: TOC */
        .toc-item {
            display: block;
            padding: 4px 0 4px 10px;
            color: var(--text-muted);
            border-left: 1px solid transparent;
            font-size: 0.75rem;
            transition: all 0.2s;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            cursor: pointer;
        }

        .toc-item:hover,
        .toc-item.active {
            color: var(--secondary-color);
            border-left-color: var(--secondary-color);
            background: linear-gradient(90deg, rgba(var(--secondary-color), 0.05), transparent);
            padding-left: 14px;
        }

        /* ‰∏ªÈòÖËØªÂô®ÂÆπÂô® */
        .glass-panel {
            background: var(--glass-bg);
            backdrop-filter: blur(16px);
            border: 1px solid var(--glass-border);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            position: relative;
            margin-bottom: 4rem;
            min-height: 80vh;
            opacity: 1 !important;
            animation: none !important;
        }

        /* Ë£ÖÈ•∞ÊÄß HUD ËßíÊ†á */
        .hud-corner {
            position: absolute;
            width: 10px;
            height: 10px;
            border: 2px solid var(--secondary-color);
            transition: all 0.3s;
            opacity: var(--hud-opacity);
            pointer-events: none;
        }

        .hc-tl {
            top: -1px;
            left: -1px;
            border-right: 0;
            border-bottom: 0;
        }

        .hc-tr {
            top: -1px;
            right: -1px;
            border-left: 0;
            border-bottom: 0;
        }

        .hc-bl {
            bottom: -1px;
            left: -1px;
            border-right: 0;
            border-top: 0;
        }

        .hc-br {
            bottom: -1px;
            right: -1px;
            border-left: 0;
            border-top: 0;
        }

        /* ÊñáÁ´†ÈÄöÁî®Ê†∑Âºè */
        .prose-eva h1 {
            font-family: 'Noto Serif SC', serif;
            font-size: 2.5rem;
            color: var(--text-main);
            margin: 2em 0 1em;
            line-height: 1.2;
            text-align: center;
        }

        .prose-eva h2 {
            font-family: 'Noto Serif SC', serif;
            font-size: 1.8rem;
            color: var(--secondary-color);
            border-bottom: 1px solid var(--glass-border);
            padding-bottom: 0.5rem;
            margin-top: 2.5em;
        }

        .prose-eva h2::before {
            content: '##';
            margin-right: 0.5rem;
            opacity: 0.3;
            font-family: 'JetBrains Mono';
        }

        .prose-eva p {
            margin-bottom: 1.5em;
            line-height: 1.8;
            font-size: 1.05rem;
            text-align: justify;
            color: var(--text-main);
            opacity: 0.9;
        }

        .prose-eva img {
            max-width: 100%;
            height: auto;
            display: block;
            margin: 2rem auto;
            border: 1px solid var(--glass-border);
            border-radius: 2px;
            transition: all 0.3s;
            cursor: zoom-in;
            opacity: 1 !important;
            animation: none !important;
            visibility: visible !important;
        }

        .prose-eva img:hover {
            border-color: var(--secondary-color);
            box-shadow: 0 0 15px rgba(var(--secondary-color), 0.2);
        }

        .prose-eva pre {
            background: var(--code-bg) !important;
            padding: 1rem;
            border-radius: 4px;
            overflow-x: auto;
            margin: 2em 0;
            border: 1px solid var(--glass-border);
        }

        .prose-eva code {
            font-family: 'JetBrains Mono', monospace !important;
            font-size: 0.85em;
            color: #abb2bf;
        }

        .prose-eva blockquote {
            border-left: 3px solid var(--secondary-color);
            background: rgba(var(--secondary-color), 0.05);
            padding: 1rem 1.5rem;
            font-style: italic;
            color: var(--text-muted);
            margin: 2em 0;
        }

        [data-mode="light"] .prose-eva blockquote {
            background: rgba(0, 0, 0, 0.03);
        }

        /* ÁÅØÁÆ± */
        #lightbox {
            position: fixed;
            inset: 0;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }

        #lightbox.active {
            opacity: 1;
            pointer-events: auto;
        }

        #lightbox img {
            max-width: 90vw;
            max-height: 90vh;
            border: 1px solid var(--secondary-color);
            box-shadow: 0 0 30px rgba(var(--secondary-color), 0.3);
            transform: scale(0.9);
            transition: transform 0.3s;
        }

        #lightbox.active img {
            transform: scale(1);
        }

        /* ËØÑËÆ∫Âå∫ (MAGI COMMS) */
        .comm-entry {
            border-left: 2px solid var(--glass-border);
            padding-left: 1rem;
            margin-bottom: 1.5rem;
            transition: all 0.3s;
        }

        .comm-entry:hover {
            border-left-color: var(--secondary-color);
        }

        .comm-meta {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
            font-family: 'JetBrains Mono';
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .comm-author {
            color: var(--secondary-color);
            font-weight: bold;
        }

        .comm-body {
            font-size: 0.9rem;
            color: var(--text-main);
            line-height: 1.6;
            opacity: 0.9;
        }

        .magi-input {
            background: rgba(0, 0, 0, 0.1);
            border: 1px solid var(--glass-border);
            color: var(--text-main);
            font-family: 'JetBrains Mono';
            font-size: 0.85rem;
            padding: 0.5rem;
            width: 100%;
            transition: all 0.3s;
            box-sizing: border-box;
        }

        .magi-input:focus {
            outline: none;
            border-color: var(--secondary-color);
            box-shadow: 0 0 10px rgba(var(--secondary-color), 0.1);
            background: rgba(var(--secondary-color), 0.05);
        }

        .avatar-so {
            width: 32px;
            height: 32px;
            background: #000;
            border: 1px solid var(--secondary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 6px;
            color: var(--secondary-color);
            text-align: center;
            line-height: 1;
            font-family: 'JetBrains Mono';
            box-shadow: 0 0 5px rgba(var(--secondary-color), 0.2);
            flex-shrink: 0;
        }

        .comm-chevron {
            transition: transform 0.3s;
            flex-shrink: 0;
        }

        /* Utility */
        .hidden {
            display: none !important;
        }

        .flex {
            display: flex;
        }

        .items-center {
            align-items: center;
        }

        .justify-center {
            justify-content: center;
        }

        .gap-2 {
            gap: 0.5rem;
        }

        .w-full {
            width: 100%;
        }

        .text-center {
            text-align: center;
        }

        .animate-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: .5;
            }
        }

        /* ÊªöÂä®Êù° */
        ::-webkit-scrollbar {
            width: 4px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: #555;
            border-radius: 2px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--secondary-color);
        }

        /* ==========================================================================
           üì± MOBILE OPTIMIZATION - READER PAGE
           ========================================================================== */

        /* ÁßªÂä®Á´ØÂ∫ïÈÉ®ÂØºËà™Ê†è */
        .mobile-bottom-nav {
            display: none;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 56px;
            background: var(--glass-bg);
            backdrop-filter: blur(16px);
            border-top: 1px solid var(--glass-border);
            z-index: 100;
            padding: 0;
            padding-bottom: env(safe-area-inset-bottom, 0);
        }

        .mobile-nav-inner {
            display: flex;
            justify-content: space-around;
            align-items: center;
            height: 56px;
        }

        .mobile-nav-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 4px;
            color: var(--text-muted);
            background: transparent;
            border: none;
            padding: 8px 16px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 9px;
            cursor: pointer;
            transition: color 0.2s;
            min-width: 60px;
        }

        .mobile-nav-btn:active,
        .mobile-nav-btn:hover {
            color: var(--secondary-color);
        }

        .mobile-nav-btn svg {
            width: 20px;
            height: 20px;
        }

        /* ÁßªÂä®Á´Ø TOC ÊäΩÂ±â */
        .mobile-toc-drawer {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 200;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }

        .mobile-toc-drawer.active {
            opacity: 1;
            pointer-events: auto;
        }

        .mobile-toc-content {
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 280px;
            max-width: 80vw;
            background: var(--glass-bg);
            backdrop-filter: blur(16px);
            border-right: 1px solid var(--glass-border);
            padding: 1rem;
            overflow-y: auto;
            transform: translateX(-100%);
            transition: transform 0.3s cubic-bezier(0.16, 1, 0.3, 1);
        }

        .mobile-toc-drawer.active .mobile-toc-content {
            transform: translateX(0);
        }

        .mobile-toc-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--glass-border);
            margin-bottom: 1rem;
        }

        .mobile-toc-title {
            font-family: 'JetBrains Mono', monospace;
            font-size: 12px;
            color: var(--secondary-color);
            letter-spacing: 0.1em;
        }

        .mobile-toc-close {
            background: transparent;
            border: 1px solid var(--glass-border);
            color: var(--text-muted);
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        /* ÈòÖËØªÊó∂Èó¥‰º∞ÁÆó */
        .reading-time {
            font-family: 'JetBrains Mono', monospace;
            font-size: 10px;
            color: var(--text-muted);
            display: flex;
            align-items: center;
            gap: 4px;
        }

        @media (max-width: 1279px) {

            /* ÊòæÁ§∫ÁßªÂä®Á´ØÂ∫ïÈÉ®ÂØºËà™ */
            .mobile-bottom-nav {
                display: block;
            }

            /* ‰∏∫Â∫ïÊ†èÁïôÁ©∫Èó¥ */
            body {
                padding-bottom: 70px !important;
            }

            /* ÂáèÂ∞ëÂÜÖÂÆπÂå∫ËæπË∑ù */
            .tactical-grid {
                padding-left: 0.75rem !important;
                padding-right: 0.75rem !important;
            }

            /* ÂØºËà™Ê†èÁÆÄÂåñ */
            .tactical-nav {
                padding: 0 0.75rem !important;
            }

            /* A+ ÊåâÈíÆÂ¢ûÂ§ßËß¶ÊéßÂå∫Âüü */
            .nav-btn-link {
                min-height: 44px;
                min-width: 44px;
                display: flex;
                align-items: center;
                justify-content: center;
            }
        }

        @media (max-width: 768px) {

            /* ÊñáÁ´†Ê†áÈ¢òÂ≠óÂè∑Ë∞ÉÊï¥ */
            .prose-eva h1 {
                font-size: 1.75rem !important;
                margin-top: 1rem !important;
            }

            .prose-eva h2 {
                font-size: 1.25rem !important;
            }

            .prose-eva p {
                font-size: 1rem !important;
                text-align: left !important;
                /* ÂèñÊ∂à‰∏§Á´ØÂØπÈΩêÔºåÁßªÂä®Á´ØÊõ¥Â•ΩËØª */
            }

            /* ‰ª£Á†ÅÂùóÊ®™ÂêëÊªöÂä® */
            .prose-eva pre {
                max-width: calc(100vw - 2rem);
                font-size: 0.75rem;
            }

            /* ÂõæÁâáÂÖ®ÂÆΩ */
            .prose-eva img {
                margin-left: -0.75rem;
                margin-right: -0.75rem;
                max-width: calc(100% + 1.5rem);
                width: calc(100% + 1.5rem);
            }

            /* ËØÑËÆ∫Âå∫‰ºòÂåñ */
            .comm-entry {
                padding-left: 0.5rem;
            }

            /* ÂºïÁî®Ê°Ü */
            .prose-eva blockquote {
                padding: 0.75rem 1rem;
                margin-left: 0;
                margin-right: 0;
            }

            /* ÈöêËóè PC Á´ØÂÖÉÁ¥† */
            .hidden-mobile {
                display: none !important;
            }
        }

        @media (max-width: 480px) {
            .tactical-nav {
                height: 3rem;
            }

            .tactical-grid {
                padding-top: calc(3rem + 1rem) !important;
            }

            .prose-eva h1 {
                font-size: 1.5rem !important;
            }
        }

        /* Ëß¶ÊéßËÆæÂ§á‰ºòÂåñ */
        @media (hover: none) and (pointer: coarse) {
            .widget-card:hover {
                border-left-color: inherit;
            }

            .toc-item:hover {
                color: inherit;
                border-left-color: transparent;
            }

            .toc-item:active {
                color: var(--secondary-color);
                border-left-color: var(--secondary-color);
            }
        }
    </style>
</head>

<body class="min-h-screen flex flex-col">

    <script>
            (function () {
                const mode = localStorage.getItem('visualMode') || 'dark';
                if (mode === 'light') {
                    document.documentElement.setAttribute('data-mode', 'light');
                    document.documentElement.classList.remove('dark');
                }
                const theme = localStorage.getItem('theme') || 'default';
                if (theme !== 'default') document.documentElement.setAttribute('data-theme', theme);
            })();
    </script>

    <div class="fixed top-0 left-0 w-full h-1 z-[200] bg-gray-800/20">
        <div id="scroll-progress"
            class="h-full bg-secondary w-0 shadow-[0_0_10px_var(--secondary-color)] transition-all duration-75"></div>
    </div>

    <div id="lightbox" onclick="Lightbox.close()">
        <img id="lightbox-img" src="" onclick="event.stopPropagation()">
    </div>

    <!-- üì± ÁßªÂä®Á´Ø TOC ÊäΩÂ±â -->
    <div id="mobile-toc-drawer" class="mobile-toc-drawer" onclick="MobileNav.closeToc()">
        <div class="mobile-toc-content" onclick="event.stopPropagation()">
            <div class="mobile-toc-header">
                <span class="mobile-toc-title">NAVIGATION</span>
                <button class="mobile-toc-close" onclick="MobileNav.closeToc()">
                    <i data-lucide="x"></i>
                </button>
            </div>
            <div id="mobile-toc-list">
                <!-- TOC ÂÜÖÂÆπÂ∞ÜÁî± JS Âä®ÊÄÅÂ°´ÂÖÖ -->
            </div>
        </div>
    </div>

    <!-- üì± ÁßªÂä®Á´ØÂ∫ïÈÉ®ÂØºËà™Ê†è -->
    <nav class="mobile-bottom-nav">
        <div class="mobile-nav-inner">
            <button class="mobile-nav-btn" onclick="MobileNav.openToc()">
                <i data-lucide="list"></i>
                <span>ÁõÆÂΩï</span>
            </button>
            <button class="mobile-nav-btn" onclick="MobileNav.scrollToComments()">
                <i data-lucide="message-square"></i>
                <span>ËØÑËÆ∫</span>
            </button>
            <button class="mobile-nav-btn" onclick="MobileNav.scrollToTop()">
                <i data-lucide="arrow-up"></i>
                <span>È°∂ÈÉ®</span>
            </button>
            <a href="index.html" class="mobile-nav-btn">
                <i data-lucide="home"></i>
                <span>‰∏ªÈ°µ</span>
            </a>
        </div>
    </nav>

    <nav class="tactical-nav">
        <a href="index.html" class="nav-btn-link group">
            <i data-lucide="arrow-left"></i>
            <span>ABORT</span>
        </a>
        <div class="nav-group" style="font-family: 'JetBrains Mono'; font-size: 10px; color: var(--text-muted);">
            <span class="hidden md:inline">MAGI_ARCHIVE:</span>
            <span id="stream-status" style="color: var(--secondary-color);">CONNECTING</span>
        </div>
        <div class="nav-group">
            <button onclick="changeFontSize(1)" class="nav-btn-link" style="font-size: 12px;">A+</button>
        </div>
    </nav>

    <div class="tactical-grid">

        <aside class="sidebar-left">

            <div class="widget-card" style="opacity: 1;">
                <div class="hud-corner hc-tl"></div>
                <div class="hud-corner hc-tr"></div>
                <div class="widget-header">
                    <span>PILOT_DATA</span>
                    <i data-lucide="user"></i>
                </div>
                <div class="flex items-center" style="gap: 1rem;">
                    <div class="pilot-avatar-so">SOUND<br>ONLY</div>
                    <div class="flex-1 font-mono text-xs pilot-info">
                        <div style="color: #999;">ID: <span style="color: var(--secondary-color);">Wh1te</span></div>
                        <div style="color: #999;">RANK: <span style="color: var(--primary-color);">CAPTAIN</span></div>
                        <div style="color: #666; font-size: 10px;">STATUS: ONLINE</div>
                    </div>
                </div>
                <div class="mt-4" style="margin-top: 1rem;">
                    <div class="flex"
                        style="justify-content: space-between; font-family: 'JetBrains Mono'; font-size: 9px; color: #666; margin-bottom: 4px;">
                        <span>SYNC_RATIO</span>
                        <span style="color: var(--secondary-color);">400%</span>
                    </div>
                    <div class="sync-bar-container">
                        <div class="sync-bar-fill"></div>
                    </div>
                </div>
            </div>

            <div class="widget-card" style="opacity: 1;">
                <div class="hud-corner hc-bl"></div>
                <div class="hud-corner hc-br"></div>
                <div class="widget-header">
                    <span>OPS_CONTROLS</span>
                    <i data-lucide="settings-2"></i>
                </div>
                <div class="ops-grid">
                    <div class="ops-btn" onclick="OpsControl.toggleTheme()" title="Toggle Light/Dark Mode">
                        <i data-lucide="sun-moon"></i> <span>MODE</span>
                    </div>
                    <div class="ops-btn" onclick="window.scrollTo({top:0, behavior:'smooth'})" title="Return to Top">
                        <i data-lucide="arrow-up-to-line"></i> <span>TOP</span>
                    </div>
                    <div class="ops-btn" onclick="changeFontSize(-1)">A-</div>
                    <div class="ops-btn" onclick="changeFontSize(1)">A+</div>
                    <div class="ops-btn" style="grid-column: span 2; border-color: rgba(255,0,0,0.3); color: #ff6b6b;"
                        onclick="window.location.href='index.html'">
                        <i data-lucide="log-out"></i> <span>EMERGENCY EJECT</span>
                    </div>
                </div>
            </div>

            <div class="widget-card" style="opacity: 1;">
                <div class="widget-header">
                    <span>INDEX_STRUCTURE</span>
                    <i data-lucide="list-tree"></i>
                </div>
                <div id="toc-container"
                    style="max-height: 300px; overflow-y: auto; font-family: 'JetBrains Mono'; font-size: 12px; gap: 4px; display: flex; flex-direction: column;">
                    <div class="text-center" style="opacity: 0.3; padding: 1rem;">SCANNING...</div>
                </div>
            </div>

        </aside>

        <main id="infinite-wrapper" class="w-full relative">
            <div id="initial-loader" class="flex"
                style="flex-direction: column; align-items: center; justify-content: center; min-height: 50vh;">
                <div style="font-family: 'JetBrains Mono'; color: var(--secondary-color); font-size: 1.2rem; margin-bottom: 1rem; letter-spacing: 2px;"
                    class="animate-pulse">DECRYPTING...</div>
                <div style="width: 200px; height: 2px; background: rgba(255,255,255,0.1); overflow: hidden;">
                    <div
                        style="height: 100%; width: 30%; background: var(--secondary-color); animation: scan 2s linear infinite;">
                    </div>
                </div>
            </div>
        </main>

        <aside class="sidebar-right">
            <div class="widget-card h-full"
                style="height: 100%; border-style: dashed; border-color: rgba(255,255,255,0.1); display: flex; align-items: center; justify-content: center;">
                <div
                    style="font-family: 'JetBrains Mono'; font-size: 10px; color: #555; transform: rotate(-90deg); letter-spacing: 2px;">
                    RIGHT_WING_RESERVED</div>
            </div>
        </aside>

    </div>

    <div id="loading-more" class="hidden" style="padding: 2rem; text-align: center;">
        <div
            style="display: inline-flex; align-items: center; gap: 0.5rem; font-family: 'JetBrains Mono'; font-size: 12px; color: var(--secondary-color);">
            <i data-lucide="loader-2" class="animate-spin"></i>
            FETCHING NEXT ARCHIVE...
        </div>
    </div>
    <div id="end-of-line" class="hidden"
        style="padding: 3rem; text-align: center; opacity: 0.5; font-family: 'JetBrains Mono'; font-size: 10px; letter-spacing: 0.5em; color: #555;">
        /// END OF ALL RECORDS ///
    </div>

    <script>
        lucide.createIcons();

        /* --- 0. ÊàòÊúØÊéßÂà∂Âè∞ÈÄªËæë --- */
        const OpsControl = {
            toggleTheme() {
                const isLight = document.documentElement.getAttribute('data-mode') === 'light';
                if (isLight) {
                    document.documentElement.removeAttribute('data-mode');
                    document.documentElement.classList.add('dark');
                    localStorage.setItem('visualMode', 'dark');
                } else {
                    document.documentElement.setAttribute('data-mode', 'light');
                    document.documentElement.classList.remove('dark');
                    localStorage.setItem('visualMode', 'light');
                }
            }
        };

        /* --- 1. ÁÅØÁÆ±Á≥ªÁªü --- */
        const Lightbox = {
            open(src) {
                const box = document.getElementById('lightbox');
                const img = document.getElementById('lightbox-img');
                img.src = src;
                box.classList.add('active');
            },
            close() { document.getElementById('lightbox').classList.remove('active'); }
        };

        /* --- 2. ÊàòÊúØÂõæÂÉèÂ§ÑÁêÜÂô® --- */
        const TacticalImager = {
            processUrl(url) {
                if (!url || typeof url !== 'string' || url === 'undefined') return '';
                if (url.includes('images.weserv.nl')) return url;
                if (url.startsWith('http://') || url.includes('infinityfreeapp.com')) {
                    let cleanUrl = url.replace(/^https?:\/\//i, '');
                    return `https://images.weserv.nl/?url=${encodeURIComponent(cleanUrl)}&output=webp&q=85&we`;
                }
                return url;
            },
            sanitizeHtmlString(htmlString) {
                if (!htmlString) return '';
                let safeHtml = htmlString;
                safeHtml = safeHtml.replace(/srcset=["'][^"']*["']/gi, '');
                safeHtml = safeHtml.replace(/src=["'](http:\/\/[^"']+|https:\/\/[^"']*infinityfreeapp[^"']*)["']/gi, (match, url) => {
                    return `src="${this.processUrl(url)}"`;
                });
                return safeHtml;
            }
        };

        /* --- 3. ËØÑËÆ∫Á≥ªÁªü --- */
        const CommentManager = {
            apiBase: 'https://eva-proxy.whte97284.workers.dev/blog/comments',
            toggleComms(btn, postId) {
                const container = document.getElementById(`comms-${postId}`);
                const textSpan = btn.querySelector('span');
                const chevron = btn.querySelector('.comm-chevron');
                if (container.classList.contains('hidden')) {
                    container.classList.remove('hidden');
                    if (textSpan) textSpan.innerText = `CLOSE_COMMS_CHANNEL [ ID: ${postId} ]`;
                    if (chevron) chevron.classList.add('rotate-180');
                    this.loadComments(postId);
                } else {
                    container.classList.add('hidden');
                    if (textSpan) textSpan.innerText = `OPEN_COMMS_CHANNEL [ ID: ${postId} ]`;
                    if (chevron) chevron.classList.remove('rotate-180');
                }
            },
            async loadComments(postId) {
                const container = document.getElementById(`comms-${postId}`);
                const url = `${this.apiBase}?post=${postId}&per_page=20`;
                const proxies = ['https://corsproxy.io/?', 'https://api.allorigins.win/raw?url='];
                container.innerHTML = `<div class="text-center" style="padding: 1rem; font-family: 'JetBrains Mono'; font-size: 12px; color: var(--secondary-color);">SEARCHING FREQUENCIES...</div>`;
                try {
                    const res = await fetch(url);
                    if (res.ok) {
                        const data = await res.json();
                        this.renderForm(container, postId);
                        this.renderList(container, data);
                        return;
                    }
                } catch (e) { console.log("Worker direct link failed, trying proxies..."); }
                let success = false;
                for (const proxy of proxies) {
                    try {
                        const res = await fetch(proxy + encodeURIComponent(url));
                        const text = await res.text();
                        if (text.trim().startsWith('<')) throw new Error("Firewall Intercepted");
                        const data = JSON.parse(text);
                        this.renderForm(container, postId);
                        this.renderList(container, data);
                        success = true;
                        break;
                    } catch (e) { }
                }
                if (!success) container.innerHTML = `<div style="color: #ff5555; font-family: 'JetBrains Mono'; font-size: 12px; text-align: center; border: 1px solid rgba(255,0,0,0.3); padding: 0.5rem;">CONNECTION FAILED</div>`;
            },
            renderForm(container, postId) {
                container.innerHTML = `
                    <div style="margin-bottom: 2rem; padding: 1rem; border: 1px solid rgba(255,255,255,0.05); background: rgba(0,0,0,0.1);">
                        <div style="font-family: 'JetBrains Mono'; font-size: 10px; color: var(--secondary-color); margin-bottom: 0.5rem;">/// TRANSMIT_DATA</div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; margin-bottom: 0.5rem;">
                            <input type="text" id="c-name-${postId}" class="magi-input" placeholder="CODENAME (Name)">
                            <input type="email" id="c-email-${postId}" class="magi-input" placeholder="SIGNAL_ID (Email)">
                        </div>
                        <textarea id="c-msg-${postId}" class="magi-input" style="height: 80px; margin-bottom: 0.5rem;" placeholder="DATA_PACKET (Message)..."></textarea>
                        <button onclick="CommentManager.postComment(${postId})" style="width: 100%; background: rgba(var(--secondary-color), 0.1); border: 1px solid var(--secondary-color); color: var(--secondary-color); font-weight: bold; font-family: 'JetBrains Mono'; font-size: 12px; padding: 0.5rem; cursor: pointer;">SEND TRANSMISSION</button>
                        <div id="c-status-${postId}" class="hidden" style="margin-top: 0.5rem; font-size: 10px; font-family: 'JetBrains Mono'; color: #666;"></div>
                    </div><div class="space-y-4"></div>`;
            },
            renderList(container, comments) {
                const listEl = container.lastElementChild;
                if (!comments || comments.length === 0) {
                    listEl.innerHTML = `<div style="text-align: center; opacity: 0.3; font-family: 'JetBrains Mono'; font-size: 12px;">NO SIGNALS DETECTED.</div>`;
                    return;
                }
                listEl.innerHTML = comments.map(c => {
                    let avatarUrl = c.author_avatar_urls ? c.author_avatar_urls['48'] : null;
                    if (avatarUrl) avatarUrl = TacticalImager.processUrl(avatarUrl);
                    const avatarHTML = avatarUrl ? `<img src="${avatarUrl}" style="width: 32px; height: 32px; border-radius: 50%; border: 1px solid rgba(255,255,255,0.1); flex-shrink: 0;">` : `<div class="avatar-so">SOUND<br>ONLY</div>`;
                    return `<div class="comm-entry"><div class="comm-meta">${avatarHTML}<div><span class="comm-author">${c.author_name}</span><span style="opacity: 0.5; margin: 0 0.5rem;">|</span><span>${new Date(c.date).toISOString().replace('T', ' ').substring(0, 16)}</span></div></div><div class="comm-body pl-10 prose-eva text-sm">${c.content.rendered}</div></div>`;
                }).join('');
            },
            async postComment(postId) {
                const name = document.getElementById(`c-name-${postId}`).value;
                const email = document.getElementById(`c-email-${postId}`).value;
                const content = document.getElementById(`c-msg-${postId}`).value;
                const statusEl = document.getElementById(`c-status-${postId}`);
                if (!name || !email || !content) {
                    statusEl.innerText = "ERROR: INCOMPLETE DATA PACKET."; statusEl.classList.remove('hidden'); statusEl.style.color = '#ff5555'; return;
                }
                statusEl.innerText = "UPLOADING..."; statusEl.classList.remove('hidden'); statusEl.style.color = 'var(--secondary-color)';
                const formData = new FormData();
                formData.append('author_name', name); formData.append('author_email', email); formData.append('content', content); formData.append('post', postId);
                try {
                    const res = await fetch(this.apiBase, { method: 'POST', body: formData });
                    if (!res.ok) { const err = await res.json(); throw new Error(err.message || `HTTP ${res.status}`); }
                    statusEl.innerText = "TRANSMISSION COMPLETE. SYNCING..."; document.getElementById(`c-msg-${postId}`).value = '';
                    setTimeout(() => this.loadComments(postId), 1000);
                } catch (e) { statusEl.innerHTML = `UPLOAD FAILED: ${e.message}`; statusEl.classList.remove('hidden'); statusEl.style.color = '#ff5555'; }
            }
        };

        /* --- 4. ÊµÅÂºèÈòÖËØªÂô® --- */
        const StreamReader = {
            apiBase: 'https://eva-proxy.whte97284.workers.dev/blog/post',
            postsApi: 'https://eva-proxy.whte97284.workers.dev/blog/posts',
            fullContentNodes: [],
            renderPointer: 0,
            CHUNK_SIZE: 15,
            lastPostDate: null,
            isFetching: false,
            hasMore: true,

            init() {
                const params = new URLSearchParams(window.location.search);
                const id = params.get('id');
                if (!id) { this.fetchNextArticle(true); }
                else {
                    document.getElementById('stream-status').innerText = `REQ_ID:${id}`;
                    this.fetchArticleById(id);
                }
                window.addEventListener('scroll', () => {
                    const { scrollTop, scrollHeight, clientHeight } = document.documentElement;
                    if (scrollTop + clientHeight >= scrollHeight - 300) { this.fetchNextArticle(); }
                    this.handleScroll();
                    this.checkStreamTrigger();
                });
            },

            async fetchArticleById(id) {
                const url = `${this.apiBase}?id=${id}`;
                await this.performFetch(url, true);
            },

            async fetchNextArticle(isInitial = false) {
                if (this.isFetching || !this.hasMore) return;
                let url = `${this.postsApi}?_embed&per_page=1&_fields=id,date,link,title,excerpt,content,_links,_embedded`;
                if (this.lastPostDate) url += `&before=${this.lastPostDate}`;
                document.getElementById('loading-more').classList.remove('hidden');
                await this.performFetch(url, isInitial, true);
            },

            async performFetch(url, isInitial = false, isList = false) {
                this.isFetching = true;
                let lastError = null;
                try {
                    const res = await fetch(url);
                    if (!res.ok) throw new Error(`HTTP ${res.status}`);
                    const text = await res.text();
                    if (text.trim().startsWith('<') && !text.includes('wp-json')) throw new Error("Worker Firewall Intercepted");

                    let data;
                    try { data = JSON.parse(text); } catch (e) { throw new Error("Invalid JSON Data"); }

                    if (isList) {
                        if (!Array.isArray(data) || data.length === 0) {
                            this.hasMore = false;
                            document.getElementById('loading-more').classList.add('hidden');
                            document.getElementById('end-of-line').classList.remove('hidden');
                            return;
                        }
                        data = data[0];
                    }
                    this.lastPostDate = data.date;
                    this.render(data);
                } catch (e) {
                    console.error(e);
                    lastError = e;
                    if (isInitial) this.showError(`CONNECTION FAILED: ${lastError.message}`);
                } finally {
                    this.isFetching = false;
                    if (isInitial) document.getElementById('initial-loader').classList.add('hidden');
                    document.getElementById('loading-more').classList.add('hidden');
                }
            },

            render(data) {
                if (!data || !data.title || !data.content) {
                    console.error("DATA CORRUPTED:", data);
                    const wrapper = document.getElementById('infinite-wrapper');
                    wrapper.innerHTML += `<div class="glass-panel" style="padding: 2rem; text-align: center; color: #ff5555; font-family: 'JetBrains Mono'; font-size: 12px;">/// ERROR: DATA_SEGMENT_CORRUPTED ///</div>`;
                    return;
                }

                const title = data.title.rendered || "UNKNOWN_TITLE";
                const date = data.date ? new Date(data.date).toISOString().split('T')[0] : "0000-00-00";
                const contentHtml = data.content.rendered || "";

                const wrapper = document.getElementById('infinite-wrapper');
                const articleEl = document.createElement('div');
                articleEl.className = 'glass-panel';
                articleEl.style.padding = '2rem 4rem'; // Ê®°Êãü md:p-16
                articleEl.style.marginBottom = '4rem';
                articleEl.style.minHeight = '60vh';

                articleEl.innerHTML = `
                    <div class="hud-corner hc-tl"></div><div class="hud-corner hc-tr"></div>
                    <div class="hud-corner hc-bl"></div><div class="hud-corner hc-br"></div>
                    <header class="mb-10 text-center" style="margin-bottom: 2.5rem; text-align: center;">
                        <div style="display: inline-flex; align-items: center; gap: 0.75rem; margin-bottom: 1rem; opacity: 0.7;">
                            <span style="padding: 2px 4px; border: 1px solid var(--primary-color); color: var(--primary-color); font-family: 'JetBrains Mono'; font-size: 10px; font-weight: bold;">ARCHIVE</span>
                            <span style="font-family: 'JetBrains Mono'; font-size: 10px; color: #888;">${date}</span>
                        </div>
                        <h1 class="text-3xl md:text-5xl" style="font-family: 'Noto Serif SC', serif; font-weight: 900; font-size: 2.5rem; line-height: 1.2; margin-bottom: 1.5rem; color: var(--text-main);">${title}</h1>
                    </header>
                    <div class="prose-eva article-content" id="stream-container-${data.id}" style="font-size: ${currentZoom}rem;"></div>
                    <div class="chunk-loader hidden" id="stream-trigger-${data.id}"><span>/// DECODING... ///</span></div>
                    
                    <div style="margin-top: 3rem; border-top: 1px solid rgba(255,255,255,0.05); padding-top: 2rem;">
                        <button onclick="CommentManager.toggleComms(this, ${data.id})" style="width: 100%; border: 1px solid rgba(var(--secondary-color), 0.3); background: rgba(var(--secondary-color), 0.05); color: var(--secondary-color); font-family: 'JetBrains Mono'; font-size: 12px; padding: 0.75rem; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 0.5rem;">
                            <i data-lucide="message-square" style="width: 16px; height: 16px;"></i>
                            <span>OPEN_COMMS_CHANNEL [ ID: ${data.id} ]</span>
                            <i data-lucide="chevron-down" class="comm-chevron" style="width: 16px; height: 16px;"></i>
                        </button>
                        <div id="comms-${data.id}" class="hidden" style="margin-top: 1.5rem;">
                            <div style="text-align: center; padding: 1rem; font-family: 'JetBrains Mono'; font-size: 12px; color: #888;">INITIALIZING UPLINK...</div>
                        </div>
                    </div>
                    <footer style="margin-top: 4rem; padding-top: 2rem; border-top: 1px solid rgba(255,255,255,0.05); text-align: center; opacity: 0.5;">
                        <div style="font-family: 'JetBrains Mono'; font-size: 10px; letter-spacing: 0.3em;">/// E.O.F ///</div>
                    </footer>
                `;
                wrapper.appendChild(articleEl);

                const safeContent = TacticalImager.sanitizeHtmlString(contentHtml);
                this.prepareStream(safeContent, data.id);

                lucide.createIcons();
            },

            prepareStream(html, id) {
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');
                this.fullContentNodes = Array.from(doc.body.children);
                this.renderPointer = 0;
                this.currentStreamContainer = document.getElementById(`stream-container-${id}`);
                this.currentStreamTrigger = document.getElementById(`stream-trigger-${id}`);
                document.getElementById('initial-loader').classList.add('hidden');
                document.getElementById('stream-status').innerText = "STREAMING";

                if (!this.tocGenerated) {
                    this.updateTOC(doc);
                    this.tocGenerated = true;
                }

                this.renderNextChunk();
            },

            renderNextChunk() {
                if (!this.currentStreamContainer) return;
                if (this.renderPointer >= this.fullContentNodes.length) {
                    if (this.currentStreamTrigger) this.currentStreamTrigger.classList.add('hidden');
                    return;
                }
                const end = Math.min(this.renderPointer + this.CHUNK_SIZE, this.fullContentNodes.length);
                const chunkNodes = this.fullContentNodes.slice(this.renderPointer, end);
                const chunkDiv = document.createElement('div');
                chunkDiv.className = 'content-chunk';

                chunkNodes.forEach(node => {
                    const clone = document.importNode(node, true);

                    if (clone.tagName === 'IMG') {
                        clone.removeAttribute('srcset');
                        clone.setAttribute('loading', 'eager');
                        if (clone.src) clone.src = TacticalImager.processUrl(clone.src);
                        clone.onclick = () => Lightbox.open(clone.src);
                    }
                    const imgs = clone.querySelectorAll('img');
                    imgs.forEach(img => {
                        img.removeAttribute('srcset');
                        img.setAttribute('loading', 'eager');
                        if (img.src) img.src = TacticalImager.processUrl(img.src);
                        img.onclick = () => Lightbox.open(img.src);
                    });

                    if (clone.tagName === 'PRE') hljs.highlightElement(clone.querySelector('code') || clone);
                    clone.querySelectorAll('pre code').forEach(c => hljs.highlightElement(c));
                    chunkDiv.appendChild(clone);
                });

                this.currentStreamContainer.appendChild(chunkDiv);
                this.renderPointer = end;
                if (this.renderPointer < this.fullContentNodes.length && this.currentStreamTrigger) {
                    this.currentStreamTrigger.classList.remove('hidden');
                }
            },

            checkStreamTrigger() {
                if (!this.currentStreamTrigger || this.currentStreamTrigger.classList.contains('hidden')) return;
                if (this.currentStreamTrigger.getBoundingClientRect().top <= window.innerHeight + 200) this.renderNextChunk();
            },

            updateTOC(doc) {
                const tocContainer = document.getElementById('toc-container');
                const headers = doc.querySelectorAll('h2, h3');
                if (headers.length > 0) {
                    tocContainer.innerHTML = '';
                    headers.forEach((header, index) => {
                        const item = document.createElement('div');
                        item.className = `toc-item ${header.tagName === 'H3' ? 'pl-4 opacity-70' : ''}`;
                        item.innerText = header.innerText;
                        item.onclick = () => {
                            const realHeaders = document.querySelectorAll('h2, h3');
                            if (realHeaders[index]) realHeaders[index].scrollIntoView({ behavior: 'smooth', block: 'start' });
                        };
                        tocContainer.appendChild(item);
                    });
                } else {
                    tocContainer.innerHTML = '<div class="text-center opacity-30 py-4">NO INDEX DATA</div>';
                }
            },

            handleScroll() {
                const scrollTop = window.scrollY;
                const docHeight = document.body.scrollHeight - window.innerHeight;
                const progress = (scrollTop / docHeight) * 100;
                const progressBar = document.getElementById('scroll-progress');
                if (progressBar) progressBar.style.width = `${progress}%`;
            },

            showError(msg) {
                const loader = document.getElementById('initial-loader');
                if (loader) loader.innerHTML = `<div class="text-red-500 font-mono text-xs text-center">${msg}<br><a href="index.html" class="underline mt-2 inline-block">RETURN</a></div>`;
            }
        };

        let currentZoom = 1;
        function changeFontSize(dir) {
            currentZoom += dir * 0.1;
            currentZoom = Math.min(Math.max(currentZoom, 0.8), 1.4);
            const contents = document.querySelectorAll('.article-content');
            contents.forEach(el => el.style.fontSize = `${currentZoom}rem`);
        }

        /* ========================================
           üì± MOBILE NAVIGATION MODULE
           ======================================== */
        const MobileNav = {
            drawer: null,
            tocList: null,

            init() {
                this.drawer = document.getElementById('mobile-toc-drawer');
                this.tocList = document.getElementById('mobile-toc-list');

                // Â§çÂà∂Ê°åÈù¢Á´Ø TOC Âà∞ÁßªÂä®Á´Ø
                this.syncToc();

                // ÈáçÊñ∞ÂàùÂßãÂåñ Lucide ÂõæÊ†á
                if (typeof lucide !== 'undefined') {
                    lucide.createIcons();
                }
            },

            syncToc() {
                // Á≠âÂæÖÊ°åÈù¢Á´Ø TOC ÁîüÊàêÂêéÂêåÊ≠•
                const checkToc = setInterval(() => {
                    const desktopToc = document.getElementById('toc');
                    if (desktopToc && desktopToc.children.length > 0) {
                        clearInterval(checkToc);
                        if (this.tocList) {
                            this.tocList.innerHTML = desktopToc.innerHTML;
                            // ‰∏∫ÁßªÂä®Á´Ø TOC È°πÊ∑ªÂä†ÂÖ≥Èó≠ÊäΩÂ±âÁöÑ‰∫ã‰ª∂
                            this.tocList.querySelectorAll('.toc-item').forEach(item => {
                                item.addEventListener('click', () => {
                                    this.closeToc();
                                });
                            });
                        }
                    }
                }, 500);

                // 10ÁßíÂêéÂÅúÊ≠¢Ê£ÄÊü•
                setTimeout(() => clearInterval(checkToc), 10000);
            },

            openToc() {
                if (this.drawer) {
                    this.drawer.classList.add('active');
                    document.body.style.overflow = 'hidden';
                }
            },

            closeToc() {
                if (this.drawer) {
                    this.drawer.classList.remove('active');
                    document.body.style.overflow = '';
                }
            },

            scrollToTop() {
                window.scrollTo({
                    top: 0,
                    behavior: 'smooth'
                });
            },

            scrollToComments() {
                const commSection = document.getElementById('magi-comm-section');
                if (commSection) {
                    commSection.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            }
        };

        // ÈòÖËØªÊó∂Èó¥‰º∞ÁÆóÔºàÂü∫‰∫é‰∏≠ÊñáÈòÖËØªÈÄüÂ∫¶Á∫¶ 400 Â≠ó/ÂàÜÈíüÔºâ
        function estimateReadingTime(text) {
            const charCount = text.replace(/\s/g, '').length;
            const minutes = Math.ceil(charCount / 400);
            return minutes;
        }

        StreamReader.init();

        // Âª∂ËøüÂàùÂßãÂåñÁßªÂä®Á´ØÂØºËà™ÔºàÁ≠âÂæÖ DOM ÂÆåÂÖ®Âä†ËΩΩÔºâ
        setTimeout(() => MobileNav.init(), 100);
    </script>
</body>

</html>
